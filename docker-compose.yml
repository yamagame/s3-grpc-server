version: '3.8'

services:
  moto:
    restart: always
    hostname: moto
    image: "motoserver/moto:4.1.6"
    ports:
      - 5000:5000

  grpc-server:
    restart: always
    hostname: grpc-server
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 50051:50051
    tty: true
    environment:
      AWS_SDK_LOAD_CONFIG: false
      AWS_PROFILE: default
      AWS_REGION: ap-northeast-1
      AWS_ACCESS_KEY_ID: my-access-key
      AWS_SECRET_ACCESS_KEY: my-secret-key
      S3_BUCKET_NAME: sample-bucket
      S3_ENDPOINT: http://moto:5000
      COGNITO_ENDPOINT: http://moto:5000
    volumes:
      - ./:/app
    working_dir: /app
